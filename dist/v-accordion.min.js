/**
 * vAccordion - AngularJS multi-level accordion component
 * @version v1.1.0
 * @link http://lukaszwatroba.github.io/v-accordion
 * @author Łukasz Wątroba <l@lukaszwatroba.com>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */

!function(e){"use strict";function n(){return{restrict:"E",transclude:!0,controller:t,scope:{control:"=?",allowMultiple:"=?multiple",expandCb:"&?onexpand",collapseCb:"&?oncollapse"},link:function(n,t,a,i,o){function l(){e.forEach(d,function(e){if(n.control[e])throw new Error("The `"+e+"` method can not be overwritten")})}o(n.$parent,function(e){t.append(e)});var d=["toggle","expand","collapse","expandAll","collapseAll"];if(e.isDefined(n.allowMultiple)||(n.allowMultiple=e.isDefined(a.multiple)),a.$set("role","tablist"),n.allowMultiple&&a.$set("aria-multiselectable","true"),e.isDefined(n.control)){l();var c=e.extend({},n.internalControl,n.control);n.control=n.internalControl=c}else n.control=n.internalControl}}}function t(n){var t=this,a=!1;n.panes=[],t.hasExpandedPane=function(){for(var e=!1,t=0,a=n.panes.length;a>t;t++){var i=n.panes[t];if(i.isExpanded){e=!0;break}}return e},t.getPaneByIndex=function(e){return n.panes[e]},t.getPaneIndex=function(e){return n.panes.indexOf(e)},t.disable=function(){a=!0},t.enable=function(){a=!1},t.addPane=function(e){if(!n.allowMultiple&&t.hasExpandedPane()&&e.isExpanded)throw new Error("The `multiple` attribute can't be found");n.panes.push(e),e.isExpanded&&n.expandCb({index:t.getPaneIndex(e)})},t.toggle=function(e){!a&&e&&(n.allowMultiple||t.collapseAll(e),e.isExpanded=!e.isExpanded,e.isExpanded?n.expandCb({index:t.getPaneIndex(e)}):n.collapseCb({index:t.getPaneIndex(e)}))},t.expand=function(e){!a&&e&&(n.allowMultiple||t.collapseAll(e),e.isExpanded||(e.isExpanded=!0,n.expandCb({index:t.getPaneIndex(e)})))},t.collapse=function(e){!a&&e&&e.isExpanded&&(e.isExpanded=!1,n.collapseCb({index:t.getPaneIndex(e)}))},t.expandAll=function(){if(!a){if(!n.allowMultiple)throw new Error("The `multiple` attribute can't be found");e.forEach(n.panes,function(e){t.expand(e)})}},t.collapseAll=function(i){a||e.forEach(n.panes,function(e){e!==i&&t.collapse(e)})},n.internalControl={toggle:function(e){t.toggle(t.getPaneByIndex(e))},expand:function(e){t.expand(t.getPaneByIndex(e))},collapse:function(e){t.collapse(t.getPaneByIndex(e))},expandAll:t.expandAll,collapseAll:t.collapseAll}}function a(){return{restrict:"E",require:"^vPane",transclude:!0,template:"<div ng-transclude></div>",scope:{},link:function(e,n,t){t.$set("role","tabpanel")}}}function i(){return{restrict:"E",require:"^vPane",transclude:!0,template:"<div ng-transclude></div>",scope:{},link:function(e,n,t,a){t.$set("role","tab"),n.on("click",function(n){n.target.classList.contains("v-accordion-header-ignore-click")||e.$apply(function(){a.toggle()})})}}}function o(n,t,a,i){return{restrict:"E",require:"^vAccordion",transclude:!0,controller:l,scope:{isExpanded:"=?expanded"},link:function(o,l,d,c,r){function s(){c.disable(),x[0].style.maxHeight="0px",f.attr({"aria-selected":"true",tabindex:"0"}),n(function(){i.all([t.addClass(l,u.expanded),t.removeClass(l,u.collapsed)]).then(function(){c.enable(),x[0].style.maxHeight="none"}),setTimeout(function(){x[0].style.maxHeight=v[0].offsetHeight+"px"},0)},0)}function p(){c.disable(),x[0].style.maxHeight=v[0].offsetHeight+"px",f.attr({"aria-selected":"false",tabindex:"-1"}),n(function(){i.all([t.removeClass(l,u.expanded),t.addClass(l,u.collapsed)]).then(function(){c.enable()}),setTimeout(function(){x[0].style.maxHeight="0px"},0)},0)}r(o.$parent,function(e){l.append(e)}),e.isDefined(o.isExpanded)||(o.isExpanded=e.isDefined(d.expanded));var u=a.states,f=l.find("v-pane-header"),x=l.find("v-pane-content"),v=x.find("div");if(!f[0])throw new Error("The `v-pane-header` directive can't be found");if(!x[0])throw new Error("The `v-pane-content` directive can't be found");c.addPane(o),o.accordionCtrl=c,o.isExpanded?(l.addClass(u.expanded),x[0].style.maxHeight="none",f.attr({"aria-selected":"true",tabindex:0})):(l.addClass(u.collapsed),f.attr("aria-selected","false"),x[0].style.maxHeight="0px",f.attr({"aria-selected":"false",tabindex:-1})),o.$watch("isExpanded",function(e,n){return e===n?!0:(e?s():p(),void 0)})}}}function l(e){var n=this;n.toggle=function(){e.isAnimating||e.accordionCtrl.toggle(e)}}e.module("vAccordion.config",[]).constant("accordionConfig",{states:{expanded:"is-expanded",collapsed:"is-collapsed"}}),e.module("vAccordion.directives",[]),e.module("vAccordion",["vAccordion.config","vAccordion.directives"]),e.module("vAccordion.directives").directive("vAccordion",n),t.$inject=["$scope"],e.module("vAccordion.directives").directive("vPaneContent",a),e.module("vAccordion.directives").directive("vPaneHeader",i),e.module("vAccordion.directives").directive("vPane",o),o.$inject=["$timeout","$animate","accordionConfig","$q"],l.$inject=["$scope"]}(angular);